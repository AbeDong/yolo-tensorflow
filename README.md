# 表格识别（table-detection）
表格识别任务：获取PDF文档，对PDF文档中的表格区域进行识别。主要将PDF转化为图片，使用yolo的神经网络方法进行建模。



## 1. 数据预处理

table-detection的表格数据有193565张图片，约20万，进行训练集/验证集/测试集划分后，训练集183908张图片，验证集4874张图片，测试集4783张图片。

由于训练集数量庞大，无法将所有图片一起载入内存，因此在训练集/验证集/测试集中只存储**图片的路径**，按照batch进行训练时，每次读取一个batch的图片路径，通过cv2读取出其中的图像，存入内存，然后进行接下来的数据强化（data augmentation）步骤。



### 1.1 数据强化

#### random resize

设定超参数jitter，对原始图像的w和h乘以系数jitter，获得dw和dh，表示对原始图像的宽进行-dw和dw之间的一个值的缩放，对原始图像的高进行-dh和dh之间的一个值的缩放，这样获得的新的图像的宽和高的比例，记为new_ar。然后随机缩放尺度scala，scala为0.5到2之间的随机数，scala表示原始图像变换后相对于最终图像的比例，然后计算出原始图像变换图像的宽nw和高nh。然后将变换后的图像随机安排到最终图像的某一个位置。

#### random flip

将图像按50%的概率进行水平翻转。并且将label的位置也水平翻转。

#### whitening

讲图像按照z-score方法进行归一化，求出图像的均值和方差，对每一个像素点进行减去均值除以方差的变化将图像变换成均值为0，方差为1的tensor。



## 2. 实验对比

### 2.1 table-v1

模型的输入数据是网络的输入是一个4维tensor，尺寸为(128, 256, 256, 3)，分别表示一批图片的个数128、图片的宽的像素点个数256、高的像素点个数256和信道个数3。首先使用多个卷积神经网络层进行图像的特征提取，卷积神经网络层的计算过程如下步骤：

1.  **卷积层1**：卷积核大小3\*3，卷积核移动步长1，卷积核个数16，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
2.  **卷积层2**：卷积核大小3\*3，卷积核移动步长1，卷积核个数32，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
3.  **卷积层3**：卷积核大小3\*3，卷积核移动步长1，卷积核个数64，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
4.  **卷积层4**：卷积核大小3\*3，卷积核移动步长1，卷积核个数128，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
5.  **卷积层5**：卷积核大小3\*3，卷积核移动步长1，卷积核个数256，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
6.  **卷积层6**：卷积核大小3\*3，卷积核移动步长1，卷积核个数512，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
7.  **卷积层7**：卷积核大小3\*3，卷积核移动步长1，卷积核个数1024，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
8.  **卷积层8**：卷积核大小3\*3，卷积核移动步长1，卷积核个数1024，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
9.  **全连接层**：隐藏层单元数1274 （7\*7\*(1+5\*5)，7表示cell尺寸，1表示分类个数为1，5表示5个box，5表示4个坐标及confidence），激活函数sigmoid。

参数初始化：所有权重向量使用truncated_normal(0.0, sqrt(2/n))，所有偏置向量使用constant(0.0)，

使用yolo中提出的目标函数，如下图，使用Adam梯度下降法进行参数更新，学习率设为固定值0.00001，coord_scala设定为10，object_scala设定为10，nobject_scala设定为5，class_scala设定为1，batch_size设定为32。

![objective](/others/pictures/objective.png)

根据上述进行训练，收敛图如下，最终可以获得如下的训练/验证/测试的观察值：

-   训练速度：平均每秒训练25张图片，即训练50万个batch需要7.4天。
-   训练误差：
-   测试集IOU：
-   测试集识别召回率：
-   测试集识别错误率：

