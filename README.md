# 表格识别（table-detection）
表格识别任务：获取PDF文档，对PDF文档中的表格区域进行识别。主要将PDF转化为图片，使用yolo的神经网络方法进行建模。



## 1. 数据预处理

table-detection的表格数据有193565张图片，约20万，进行训练集/验证集/测试集划分后，训练集183908张图片，验证集4874张图片，测试集4783张图片。

由于训练集数量庞大，无法将所有图片一起载入内存，因此在训练集/验证集/测试集中只存储**图片的路径**，按照batch进行训练时，每次读取一个batch的图片路径，通过cv2读取出其中的图像，存入内存，然后进行接下来的数据强化（data augmentation）步骤。



### 1.1 数据强化

#### random resize

设定超参数jitter，对原始图像的w和h乘以系数jitter，获得dw和dh，表示对原始图像的宽进行-dw和dw之间的一个值的缩放，对原始图像的高进行-dh和dh之间的一个值的缩放，这样获得的新的图像的宽和高的比例，记为new_ar。然后随机缩放尺度scala，scala为0.5到2之间的随机数，scala表示原始图像变换后相对于最终图像的比例，然后计算出原始图像变换图像的宽nw和高nh。然后将变换后的图像随机安排到最终图像的某一个位置。整个过程的大致流程图图下。

![objective](/others/pictures/resize.png)

#### random flip

将图像按50%的概率进行水平翻转。并且将label的位置也水平翻转。

#### whitening

讲图像按照z-score方法进行归一化，求出图像的均值和方差，对每一个像素点进行减去均值除以方差的变化将图像变换成均值为0，方差为1的tensor。



### 1.2 标签重定位

由于数据强化步骤中，将图像进行了放缩、位移以及翻转变换，因此标签的位置也需要进行变换。这里需要注意的是，变换后的table位置保证横纵方向都在0~1之间，这样**表格可能会被切割**。对图像和标签都进行处理之后，便获得了可以输入网络的图像和标签。

输入网络的**图像**的尺寸是（128, 256, 256, 3），分别表示一批图片的个数128、图片的宽的像素点个数256、高的像素点个数256和信道个数3。

输入网络的**标签**的尺寸是（128, 30, 5），分别表示一批标签的个数128、一个图像中最多存在的表格个数30、每个表格的标签5个量，前4位表示中心点x坐标、中心点y坐标、宽度w、高度h，第5位表示置信度，均为1。



## 2. 实验对比

### 2.1 table-v1

模型的输入数据是网络的输入是一个4维tensor，尺寸为（128, 256, 256, 3），分别表示一批图片的个数128、图片的宽的像素点个数256、高的像素点个数256和信道个数3。首先使用多个卷积神经网络层进行图像的特征提取，卷积神经网络层的计算过程如下步骤：

1.  **卷积层1**：卷积核大小3\*3，卷积核移动步长1，卷积核个数16，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
2.  **卷积层2**：卷积核大小3\*3，卷积核移动步长1，卷积核个数32，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
3.  **卷积层3**：卷积核大小3\*3，卷积核移动步长1，卷积核个数64，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
4.  **卷积层4**：卷积核大小3\*3，卷积核移动步长1，卷积核个数128，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
5.  **卷积层5**：卷积核大小3\*3，卷积核移动步长1，卷积核个数256，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
6.  **卷积层6**：卷积核大小3\*3，卷积核移动步长1，卷积核个数512，池化大小2\*2，池化步长2，池化类型为最大池化，激活函数ReLU。
7.  **卷积层7**：卷积核大小3\*3，卷积核移动步长1，卷积核个数1024，激活函数ReLU。
8.  **卷积层8**：卷积核大小3\*3，卷积核移动步长1，卷积核个数1024，激活函数ReLU。
9.  **全连接层**：隐藏层单元数1274 （4\*4\*5\*5)，4表示cell尺寸，5表示5个box，5表示4个坐标及confidence，激活函数sigmoid。

参数初始化：所有权重向量使用random_normal(0.0, sqrt(2/n))，所有偏置向量使用constant(0.0)，

使用yolo中提出的目标函数，如下图，使用Adam梯度下降法进行参数更新，学习率设为固定值0.001，coord_scala设定为10，object_scala设定为10，nobject_scala设定为3，batch_size设定为128。

![objective](/others/pictures/objective.png)
